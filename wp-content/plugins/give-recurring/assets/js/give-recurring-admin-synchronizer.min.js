(()=>{var i=wp.i18n,n=i.__,t=i.sprintf;i._x,i._n,i._nx;jQuery(document).ready((function(i){var e={progressInterval:null,hasError:!1,hasFinished:!1,pollingPeriod:1e3,updatePeriod:250,lastData:null,lastUpdate:null,init:function(){var n=i("body");n.on("sync_subscription_clicked",this.sync_subscription_details),n.on("subscription_details_synced",this.sync_subscription_transactions)},show_message:function(n,t){i(n).find(".modal-body").append(t)},print_notice:function(n,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"normal";switch(e){case"title":t="<h3>"+t+"</h3>";break;case"subtitle":t="<h4>"+t+"</h4>";break;default:t='<div class="give-recurring-sync-notice give-recurring-sync-notice-'+e+'">'+t+"</div>"}var s=i(n);s.find(".modal-body").append(t)},show_detail:function(i,s,r,a){e.print_notice(i,t(n("Checking %s","give-recurring"),s),"subtitle"),e.print_notice(i,t(n("Current %s: %s","give-recurring"),s,r)),e.print_notice(i,t(n("Gateway %s: %s","give-recurring"),s,a)),r!==a?(e.print_notice(i,t(n("Mismatch Detected: %s","give-recurring"),s),"error"),e.print_notice(i,n("Fixing Mismatch...","give-recurring")),e.print_notice(i,t(n("Mismatch Fixed: %s","give-recurring"),s),"success")):e.print_notice(i,t(n("%s is sync","give-recurring"),s),"success")},show_missing_transaction:function(i,s){var r=t(n("A donation made on %s is missing and has been added. id: %s, gatewayTransactionId: %s, amount: %s","give-recurring"),s.createdAt,s.id,s.gatewayTransactionId,s.amount);e.print_notice(i,r,"item_missing")},show_present_transaction:function(i,s){var r=t(n("The donation made on %s is already recorded. id: %s, gatewayTransactionId: %s, amount: %s","give-recurring"),s.createdAt,s.id,s.gatewayTransactionId,s.amount);e.print_notice(i,r,"item_present")},sync_subscription_details:function(t){e.disable_buttons();var s={action:"give_recurring_sync_subscription_details",subscription_id:Give_Sync_Vars.id,"give-form-id":Give_Sync_Vars.form_id,security:Give_Recurring_Vars.sync_subscription_details_nonce},r=t.modal_id;return i(r).on("hidden.bs.modal",(function(){location.reload()})),i.post(Give_Recurring_Vars.give_recurring_ajax_url,s,(function(t){if(t.data){t.data.notice&&e.print_notice(r,"* "+t.data.notice,"subtitle"),e.print_notice(r,Give_Recurring_Vars.sync_subscription_details,"title"),e.show_detail(r,n("Subscription Status","give-recurring"),t.data.details.currentStatus,t.data.details.gatewayStatus),e.show_detail(r,n("Billing Period","give-recurring"),t.data.details.currentPeriod,t.data.details.gatewayPeriod),e.show_detail(r,n("Date Created","give-recurring"),t.data.details.currentCreatedAt,t.data.details.gatewayCreatedAt),e.print_notice(r,Give_Recurring_Vars.sync_subscription_transactions,"title"),e.print_notice(r,n("Checking subscription payments","give-recurring"),"subtitle");for(var a=0;a<t.data.missingTransactions.length;a++)e.show_missing_transaction(r,t.data.missingTransactions[a]);for(a=0;a<t.data.presentTransactions.length;a++)e.show_present_transaction(r,t.data.presentTransactions[a]);e.enable_buttons()}else{if(e.show_message(r,"<h3>"+Give_Recurring_Vars.sync_subscription_details+"</h3>"),e.show_message(r,t.html),t.error)return!1;var c=jQuery.Event("subscription_details_synced");c.log_id=t.log_id,c.subscription={},c.subscription.id=s.subscription_id,c.modal_id=r,i("body").trigger(c)}})),!1},sync_subscription_transactions:function(n){var t={action:"give_recurring_sync_subscription_transactions",subscription_id:Give_Sync_Vars.id,"give-form-id":Give_Sync_Vars.form_id,log_id:n.log_id,security:Give_Recurring_Vars.sync_subscription_transactions_nonce};return e.show_message(n.modal_id,"<h3>"+Give_Recurring_Vars.sync_subscription_transactions+"</h3>"),i.post(Give_Recurring_Vars.give_recurring_ajax_url,t,(function(i){e.show_message(n.modal_id,i.html),e.enable_buttons()})),!1},enable_buttons:function(){i(".give-active-sync-message").fadeOut(),i("button.give-resync-button").prop("disabled",!1)},disable_buttons:function(){i(".give-active-sync-message").fadeIn(),i("button.give-resync-button").prop("disabled",!0)}};e.init()}))})();